<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<link href='a00_com/lib/main.css' rel='stylesheet' />
<link href="a00_com/bootstrap.min.css" rel="stylesheet" >
<script src="a00_com/jquery.min.js"></script>
<script src="a00_com/bootstrap.min.js"></script>
<script src='a00_com/lib/main.js'></script>
<!-- Custom fonts for this template-->
<link href="a00_com/vendor/fontawesome-free/css/all.min.css"
	rel="stylesheet" type="text/css">
<link
	href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
	rel="stylesheet">
<!-- Custom styles for this template-->
<link href="a00_com/css/sb-admin-2.min.css" rel="stylesheet">
<script>
let sesAuth = 0;
let sesDeptno = 0;
$(document).ready(function(){
	sidebarIncludeAjax();
	headerIncludeAjax();
	footerIncludeAjax();
function sidebarIncludeAjax(){
	$.ajax({
        url: "/sidebar",  
        type: "get",
        dataType: "text",
        success: function(data) {
        	$("#content-wrapper").before(data)
            console.log("ì‚¬ì´ë“œë°”");
        },
        error: function(error) {
            console.log("AJAX ìš”ì²­ ì‹¤íŒ¨:"+error);
        }
    });
}
function headerIncludeAjax(){
	$.ajax({
        url: "/header",  
        type: "get",
        dataType: "text",
        success: function(data) {
        	$("#headerAfter").before(data)
            console.log("í•´ë”");
        },
        error: function(error) {
            console.log("AJAX ìš”ì²­ ì‹¤íŒ¨:"+error);
        }
    });
}
function footerIncludeAjax(){
	$.ajax({
        url: "yoofooterCookie",  
        type: "get",
        dataType: "text",
        success: function(data) {
        	$("#footerBox").html(data)
            console.log("í‘¸í„°");
        },
        error: function(error) {
            console.log("AJAX ìš”ì²­ ì‹¤íŒ¨:"+error);
        }
    });
} 
let sessionInfo = {}; // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¸ì…˜ ë°ì´í„° ì €ì¥

// âœ… ì„¸ì…˜ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° (í˜ì´ì§€ ë¡œë“œ ì‹œ)
function fetchSessionInfo() {
    $.ajax({
        url: "/JunggetSessionInfo2",
        type: "GET",
        dataType: "json",
        success: function(data) {
            sessionInfo = data; // ì„¸ì…˜ ë°ì´í„° ì €ì¥
            sesAuth = data.auth
            sesDeptno = data.deptno
            console.log("âœ… ì„¸ì…˜ ì •ë³´:", sessionInfo);
         // ê°œë³„ ê°’ ì¶œë ¥ (í•„ìš” ì‹œ)
			console.log("ğŸ‘¤ ì‚¬ì›ë²ˆí˜¸(empno):", sessionInfo.empno);
			console.log("ğŸ¢ ë¶€ì„œë²ˆí˜¸(deptno):", sessionInfo.deptno);
			console.log("ğŸ”‘ ê¶Œí•œ(auth):", sessionInfo.auth);
        },
        error: function(error) {
            console.error("âŒ ì„¸ì…˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error);
        }
    });
}


// âœ… ì„¸ì…˜ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° í˜¸ì¶œ
fetchSessionInfo();

});
  document.addEventListener('DOMContentLoaded', function() {
	  
    var calendarEl = document.getElementById('calendar');

    var toDay = new Date(); // javascriptì˜ ë‚ ì§œ ê°ì²´..(í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„)
    // 2024-12-03T12:30:25 ==> ISO í‘œì¤€ì‹œê°„ í‘œí˜„ë°©ë²• : fullcalendar api 
    //alert(toDay.toISOString())
    // ì‹œê°„ì€ í•„ìš”ì—†ê³ , ë‚ ì§œë§Œ ì¶”ì¶œí• ë ¤ë©´..
    //toDay.toISOString().split("T") // ["2024-12-03","12:30:25"] ë°°ì—´ë¡œ êµ¬ë¶„í•˜ì—¬ ë‹´ê¸´ë‹¤.
    // ìµœì¢…ì ìœ¼ë¡œ í™œìš©í•  ë‚ ì§œë§Œ ì¶”ì¶œí•˜ê¸° ìœ„í•´..
    var date = toDay.toISOString().split("T")[0] 
    
    
    var calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
        // í™”ë©´ì— ë‚˜ì˜¤ëŠ” ì´ë²¤íŠ¸
      },
      initialDate: date,
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectMirror: true,
      select: function(event) {
		if(sesAuth !== 9 && (sesAuth < 2 || sesDeptno != 40)){
			alert("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.")
			return
		}
		$("#showModal").click() // ì…ë ¥ì„ ìœ„í•œ ëª¨ë‹¬ì´ ë¡œë”©ë˜ê²Œ ì²˜ë¦¬..
		$("#regBtn").show();$("#uptBtn").hide();$("#delBtn").hide()
		$("#modalTitle").text("ì¼ì •ë“±ë¡")
		console.log(event)
		console.log(event.start)
		console.log(event.end)
		console.log(event.allDay)
		addForm(event, 'I')  // ì…ë ¥ëª¨ë‹¬/ìƒì„¸ëª¨ë‹¬ì´ ê°™ì€ formì— ì˜í•´ ì²˜ë¦¬ë˜ê¸°ì— êµ¬ë¶„..(ê³µí†µí•¨ìˆ˜ì´ìš©)
        calendar.unselect()
      },
      eventClick: function(arg) {
    	  if(sesAuth !== 9 && (sesAuth < 2 || sesDeptno != 40)){
  			alert("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.")
  			return
  		}
  		$("#showModal").click() // ì…ë ¥ì„ ìœ„í•œ ëª¨ë‹¬ì´ ë¡œë”©ë˜ê²Œ ì²˜ë¦¬..
		$("#regBtn").hide();$("#uptBtn").show();$("#delBtn").show()
		$("#modalTitle").text("ì¼ì •ìƒì„¸")
		addForm(arg.event, 'D')
      },
      
      editable: true,
      dayMaxEvents: true, // allow "more" link when too many events
      events:function(info, successCallback, failureCallback){
  		$.ajax({
			url:"Dfct_calendarListAjax",
			dataType:"json",
			success:function(data){
				// calList  mngList
				var calList = data.calList;
				
            	console.log("# ê²Œì‹œíŒ í”„ë¡œì íŠ¸ #")
            	console.log(calList)
            	console.log(calList.dlist)
            	successCallback(calList)
            	var dptHTML="<option value='0'>ë¶€ì„œì„ íƒ</option>"
				$(data.mngList).each(function(idx, dfc){
					dptHTML+=`<option value='${dfc.dfct_id}'>
						ë¶ˆëŸ‰ì²˜ë¦¬ê²°ê³¼:${dfc.dfct_prcs_rslt}[${dfc.dfct_id}]
									</option>`

				})
				$("[name=dfct_id]").html(dptHTML)
            	
			},
			error:function(err){
				console.log(err)
				failureCallback(err)
			}
		})
		  
	  }
    });

    calendar.render();
    
    
    $("#regBtn").click(function(){
    	if (!validateModalForm()) return;
		if(confirm("ì¼ì • ë“±ë¡ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
			callAjax("insertDfct_calendarAjax")
		}
    })
    $("#uptBtn").click(function(){
    	if (!validateModalForm()) return;
		if(confirm("ì¼ì • ìˆ˜ì • í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
			callAjax("updateDfct_calendarAjax")
		}
    })  
    $("#delBtn").click(function(){
    	if (!validateModalForm()) return;
		if(confirm("ì¼ì • ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
			callAjax("deleteDfct_calendarAjax")
		}
    })      
    // 
// ğŸ”¹ ëª¨ë‹¬ í•„ìˆ˜ê°’ ê²€ì¦ í•¨ìˆ˜
    function validateModalForm() {
        var title = $("[name=title]").val().trim();
        var start = $("[name=start]").val().trim();
        var end = $("[name=end]").val().trim();
        var dfctId = $("[name=dfct_id]").val();

        if (title === "" || start === "" || end === "" || dfctId === "0") {
            alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            return false;
        }
        return true;
    }
    function callAjax(loc){
		$.ajax({
			url:loc,
			type:"post",
			data:$("#frm").serialize(),
			dataType:"json",
			success:function(data){
				/*
			class CudVo {
				private String msg;
				private List<?> list;	
			==> {msg:"ë“±ë¡ì„±ê³µ", list:[{id:1,title:""},{id:2,title:""},]}	
				*/
				console.log(data)
				
				console.log("## CUD ì´í›„ ##")
				alert(data.msg)	
				/// ë°ì´í„° ì¬ ëœë”ë§...
				calendar.removeAllEvents()
				calendar.addEventSource(data.list)					
			},
			error:function(err){
				console.log(err)
			}
		})
    }
    
    
  });
  // ë“±ë¡/ìƒì„¸ ë”°ë¥¸ ëª¨ë‹¬ì°½ì˜ ë°ì´í„° ì…ë ¥ formí˜•ì‹ ì²˜ë¦¬
  // ë“±ë¡ addForm(event, "I"),  ì¼ì •í´ë¦­ì‹œ addForm(arg.event, "D")
  function addForm(event, proc){
	$("#frm")[0].reset() // formë°ì´í„° ì´ˆê¸°í™”
	
	$("[name=start]").val(event.startStr)
	if(event.end==null){  // ë§ˆì§€ë§‰ë‚ ì§œê°€ ì—†ëŠ” ê²½ìš°
		$("[name=end]").val(event.startStr)
    }else{
    	$("[name=end]").val(event.endStr)
    }
	$("[name=allDay]").val(event.allDay?1:0);// event.allDay trueì¼ ë•Œ, 1 ê·¸ì™¸ëŠ” 0	
	if(proc=="D"){ // ë“±ë¡ëœ ì¼ì •ì„ í´ë¦­ì‹œì—ì„œ ê·¸ì™¸ ì •ë³´ë„ í• ë‹¹í•´ì•¼ í•œë‹¤. ê·¸ë˜ì„œ êµ¬ë¶„..
//   start end allDay title  backgroundColor textColor  
// content writer urllink
		$("[name=id]").val(event.id)
		$("[name=title]").val(event.title)
		$("[name=backgroundColor]").val(event.backgroundColor)
		$("[name=textColor]").val(event.textColor)
		$("[name=dfct_id]").val(event.extendedProps.dfct_id)
	}
	
	
  }
</script>
<style>

  body {
    margin: 0;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
</head>
<body>
 <!-- Page Wrapper -->
    <div id="wrapper">
        <!-- Sidebar -->
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">
                <!-- Topbar -->
                <!-- End of Topbar -->
				<!-- Begin Page Content -->
                <div class="container-fluid" id="headerAfter">
  <div id='calendar'></div>
  <!-- 
 	private int id; // ë²ˆí˜¸
	private int dfct_id; //ë¶ˆëŸ‰ ê´€ë¦¬ ì•„ì´ë””
	private String title;// ì œëª©
	private String start;//ì‹œì‘ì¼
	private String end;//ë§ˆì§€ë§‰ì¼
	private String backgroundcolor;//ë°°ê²½ìƒ‰
	private String textcolor;//ìƒ‰ìƒ
	private boolean allday;//ì¢…ì¼ì—¬ë¶€
	private String dfc_typ;//ë¶ˆëŸ‰ìœ í˜•
	private String dfct_pic_nm;//ë‹´ë‹¹ìëª…
	private String dfc_prd_cnfr_name;//í™•ì¸ê·¼ë¬´ìëª…
	private String dfct_prcs_rslt;//ë¶ˆëŸ‰ì²˜ë¦¬ê²°ê³¼
   -->
  <!-- ëª¨ë‹¬ ë¡œë”© ìš”ì†Œê°ì²´ --> 
  <div id="showModal"  data-toggle="modal" data-target="#exampleModalCenter"></div> 
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">íƒ€ì´í‹€</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		<form id="frm" class="form"  method="post">
		 	<input type="hidden" name="id" value="0"/>
	     <div class="row">
	      <div class="col">
	        <input type="text" class="form-control" placeholder="ì¼ì •ëª… ì…ë ¥" name="title">
	      </div>
	     </div>
	     <div class="row">
	      <div class="col">
	      	<select class="form-control"  name="allDay" >
	      		<option value="1">ì¢…ì¼</option>
	      		<option value="0">ì‹œê°„</option>
	      	</select>
	      </div>
	     </div> 	     
	     <div class="row">
	      <div class="col">
	        <input type="text" class="form-control" placeholder="ì‹œì‘ì¼ì‹œ" name="start">
	      </div>
	      <div class="col">
	      	<input type="text" class="form-control" placeholder="ì¢…ë£Œì¼ì‹œ" name="end">
	      </div>	      
	     </div>	   
	     <div class="row">
	      <div class="col">
	        <input type="color"  title="ë°°ê²½ìƒ‰ìƒ"  class="form-control" name="backgroundColor" value="#0099cc"> 
	      </div>
	      <div class="col">
	      	<input type="color" title="ê¸€ììƒ‰ìƒ"  class="form-control" name="textColor"  value="#ccffff">
	      </div>	      
	     </div>
	      <div class="row">
	      <div class="col">
	         <select  name="dfct_id" class="form-control" >
	
			</select>
	      </div>	      
	     </div>	 
	    </form> 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" id="regBtn">ë“±ë¡</button>
        <button type="button" class="btn btn-primary" id="uptBtn">ìˆ˜ì •</button>
        <button type="button" class="btn btn-warning" id="delBtn">ì‚­ì œ</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        
      </div>
    </div>
  </div>
</div>   

</body>
</html>
